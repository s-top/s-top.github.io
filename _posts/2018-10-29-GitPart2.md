---
layout: post
title: 读书笔记—Git团队协作（二）
tags: [开发技术]
---
#### 在工作流中使用命令

* 关键词：Git For Teams -- 读书笔记

### Part2 在工作流中使用命令

#### 单人团队(独立开发者)

+ 学习目的：
    + 创建一份远程仓库的本地副本
    + 为现有的文件集初始化版本控制
    + 从空的项目目录开始创建一个新的仓库
    + 通过提交消息来检查仓库历史
    + 通过分支来隔离无关的工作
    + 在本地仓库中创建提交
    + 使用标签来高亮单个提交
    + 建立你的项目与远程代码托管系统的连接

#### 1 基于issue的版本控制

“最擅长描述一个问题的人，最有可能能够解决它”。

> 工单包含以下三个主要部分：

1.问题：大致描述你想要解决的问题。

2.原因：为什么你想要做这件事(如果问题得到解决，谁将受益)？

3.质量保证测试：我将如何知道这个问题已经得到解决？

> 工单的另一种格式：

1.卡片：从用户的角度，大致描述这个问题。

2.对话：你想要解决的问题的细节。在可能的情况下，应该避免给出具体的解决方案。

3.确认：用户用于验证问题是否解决的步骤。

#### 1.1 基于issue的版本控制利弊

第一反应就是使用工单的开销相对较大，或许记事本就已经足够。但继续做项目时，开始不断地忘记一些微小的想法。如果为每个想法创建一个分支，最后也会被一大堆过时的分支搞乱。

渐渐找到你使用的代码托管系统中的工单跟踪选项，记录你对软件所做的工作。至少，它会给你一些用于创建分支和跟踪代码的编号。

+ 工作流程：
    + 在你的跟踪系统中创建一个新的工单，注明这个issue编号
    + 在你的本地仓库中，使用issuenumber-description格式创建一个新的分支
    + 完成工单描述的工作(且只完成工单中描述的工作)
    + 测试你的工作，确保已经完成并且是正确的
    + 现在有了一个“杂乱”的工作目录，其中包含了新增的文件和修改过的文件
    + 将你的缓存的修改提交至仓库
    + 将你的更改推送到备用服务器上
    + 当你对你的工作完全满意时，将你的工单分支并入主分支并将修改后的分支推送到代码托管系统中
    + 再一次测试你的工作，确保没有后续问题
    + 将你的工单标记为已关闭

#### 1.2 创建本地仓库

#### 1.2.1 克隆已有的项目：

> git clone https://gitlab.com/gitforteams/gitforteams.git

#### 1.2.2 将已有的项目迁移至Git：

第一种是下载gitforteams-zip。你可以在任何文件夹下使用初始化命令创建一个Git仓库。

> git init(初始化目录的版本控制)

将会看到Initialized empty Git repository in /..../.git/，系统并没有立即将文件加入仓库。这是git的一个特性，因为它同样允许你忽略文件，你需要主动告诉它你想要跟踪哪些文件。

如果存在相关的下一个步骤，git几乎总是会在状态(status)消息中显示有用的建议。

> git status(检测仓库的当前状态)

将文件导入git分为两个步骤。这个功能允许你在工作目录中同时进行多个无关的更改。更改可以被暂存在索引的一组提交中，每组都有一个不同的提交消息。

> git add --all(将仓库中所有文件添加至暂存区)

之后，你可以使用commit命令将你当前的状态保存到仓库。

> git commit -m "Initial import of all projct files."(将所有暂存的文件提交至仓库)

#### 1.2.3 初始化空项目

从一个什么都没有的空目录开始。

> mkdir empty-repository 和 cd empty-repository

> git init(运行git初始化命令) 和 ls -al(确认已添加隐藏的仓库文件夹)

#### 1.2.4 查看历史记录

log命令将按时间倒序输出仓库中提交消息的完整历史记录。

> git log(使用log命令查看仓库历史记录)

对于完事的代码库上的工作，看完这些消息所需的工作量是巨大且复杂的。你可以通过--oneline参数来缩短消息，只显示消息的第一行。按Q退出。

> git log --oneline(查看缩短的项目历史记录)

#### 1.3 使用分支工作

#### 1.3.1 列出分支

在默认情况下，会将master分支复制到你的本地仓库中，然后你可以直接在这个分支上工作。

> git branch --list(列出所有分支) 或者 --all(列出所有分支)

如果你在克隆仓库的本地副本中执行这个命令，应该会同时看到你的本地分支和一个远程分支。

其中，*表示你当前正在查看(或“签出”)的分支。剩下几行以remotes/origin开头：

remotes仅表示“不在本地”。

origin是一个默认约定，表示“我的副本是从这克隆的”。

最后一部分就是分支名。

> git branch --remotes(列出远程分支)

你可以访问到这些远程分支，尽管你需要在向它们提交更改之前创建你自己的副本。

#### 1.3.2 更新远程分支列表

远程分支列表不会自动更新，因此这个列表将会随着时间而落后。使用fetch命令更新这个列表。

> git fetch(获取更新的列表和所有远程分支的内容)

#### 1.3.3 使用不同的分支

当你签出一个分支时，你更新了系统(工作区)中的可见文件，来匹配仓库中存储的版本。这个切换是通过checkout命令完成的。

> git checkout --track origin/video-lessons(使用checkout命令切换分支)

旧版本的git中可能不同，如果报错，你需要升级或者运行下面的变种命令：

> git checkout --track -b video-lessons origin/video-lessons(checkout -b 启用了追踪 --track)

就是说从远程仓库origin中存储的video-lessons分支上，创建了一个名为viedo-lessons的新分支。这个远程分支的本地副本可以通过origin/video-lessons访问到，而你的自己的分支副本可以通过video-lessons访问到。

#### 1.3.4 创建新的分支

当团队规模增长时，确立团队结构的协作方式将会使你越来越多地受益。

+ 作为一个独立开发者，你或许更难明白什么时候你应该在一个不同的分支上工作。试问：
    + 如果进行得不顺利，我是否会想要完全丢弃这个想法？
    + 我正在创造的东西是否严重偏离了当前发布的软件版本？
    + 在进行发布或被软件的发布版本接受之前，我的工作是否需要经过评审？
    + 完成这项工作之前，我是否有可能切换到其他任务上去？

如果你对每个问题都持有肯定的答复，你应该考虑为你的工作创建一个新的分支。

决定什么工作需要进入新的分支的最佳方法是使用issue跟踪工具。在使用基于issue的版本控制，你的分支名应该能够反映你正在工作的工单。

可以通过checkout命令来移动到正确的分支，或者可以将你想要的父分支添加到你的命令中。

* 创建一个新的分支：

> 1.git checkout master(首先签出你希望作为起点使用的分支)

> 2.git branch 1-process_notes(创建一个新的分支)

> 3.git checkout 1-process_notes(签出新分支)

或者直接从正确的基线分支创建一个新的分支，这意味着你不需要记住之前的指令来执行额外的签出步骤：

> git checkout -b 1-process_notes master(从主分支上创建一个新的开发分支)

#### 1.4 在仓库中添加更改

每次你在工作目录中进行修改时，都需要显式地将这些更改保存到你的git仓库。这个过程分为两步：暂存，然后保存到仓库。

你可以同时添加一个或多个文件名，文件名不需要是同一种类型的。

> git add README.md process-diagram.png(将选中的已更改文件添加至你的git仓库)

> git add branch-naming-rules.png

如果你有很多文件需要添加，而且它们还不在同一个目录下，你或许会想要使用通配符来匹配子目录中的文件，或者匹配文件名相似的文件。

> git add <directory_name>/*(递归地添加指定路径中的所有文件)

> git add *.svg(添加扩展名为.svg的所有文件)

还可以完全忽略文件名，根据git中是否已知这些文件来暂存它们。通过使用--update参数，你可以暂存git中所有已知的且在上次提交之后编辑过(或修改过)的文件：

> git add --update

一次提交只会保存已添加至索引中的文件。

#### 1.4.1 在仓库中添加部分文件修改

可以选择使用--patch参数来添加已保存的文件中的部分修改。

通过




















