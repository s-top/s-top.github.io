---
layout: post
title: Ajax跨域问题
tags: [前端技术]
---
#### 全面解析Ajax跨域问题

* 关键词：跨域问题

### 一、什么是跨域

#### 产生跨域的原因：

1.浏览器的限制：当浏览器发现你的请求是跨域的时候，会做校验，如果校验不通过，将会报跨域安全问题。

2.跨域：发出去的请求只要域名，端口，协议中有一个不同，都会产生跨域。

3.发送的是xhr（XMLHTTPRequest）请求，如果发送的不是xhr请求，就算是跨域，浏览器也不会报错。


### 二、解决思路

#### 跨域解决方案：

1.浏览器-->需用户配置。

2.XHR-->JSONP。

3.跨域：

  （1）被调用方修改代码支持跨域。

  （2）调用方隐藏跨域（通过代理）。

### 三、全面解决跨域问题

#### 1.浏览器的跨域设置:

在浏览器的属性设置页面的目标输入框里加上--disable-web-security，这样就可以让浏览器支持跨域了。

#### 2.JSONP解决跨域问题：

（1）利用script标签，请求可以跨域来解决跨域问题。

（2）办法：使用ajax发送请求，dataType为JSONP，即可解决跨域问题。

（3）但这需要接口返回一个script标签，如果返回其他格式的数据，浏览器将会把它当成是js代码解析，所以将会报错。

（4）jsonp是一种非正式传输协议，是前后台约定的协议，而不是官方协议。

（5）jsonp的实现原理是：前后台约定带有“callback”这个参数的请求就是jsonp请求，前台发出去的请求加了“callback”参数，当后台发现请求中带“callback”时，后台就知道这是一个jsonp请求，就会把返回的数据由json变成JS代码返回，JS代码内容就是一个函数的调用，函数名是“callback”参数的值，而原来需要返回的json对象数据在这里作为参数传递返回。

（6）jsonp实现原理：jquery动态创建一个script，使用script发送出去，不是xhr请求。后台与前台约定使用相同的如callback函数，服务器返回的就会是javascript脚本，不是json。jsonp除了callback还有一个_的函数，是防止缓存的。如果cache设置为true，就没有_函数。

#### 3.JSONP请求的弊端：

（1）服务器需要改动代码支持

（2）只支持GET

（3）发送的不是XHR请求

#### 4.跨域解决方向：

（1）被调用方解决（在响应头增加指定字段，告诉浏览器允许调用。这种解决方案的请求是直接从浏览器发送的）

* 服务端实现：在响应头中返回规定字段，允许指定地址和指定方法请求数据，如果要指定多个，可以将地址和方法改成*号即可。

* NGINX配置
* APACHE配置

（2）调用发解决（这是隐藏跨域的解决法案。这种跨域请求不是直接从浏览器发送的，而是从中间的http服务器转发过去的）

